在前面的内容中读者已经知道，在做Inline Hook的时候是通过构造一个jmp指令来修改目标函数入口的字节内容。在构造jmp指令时唯一比较不好理解的可能是计算jmp指令后面的偏移量，这是由于CPU机器码要求jmp指令后是一个偏移量。既然是修改目标函数入口的指令，那么可以多修改几条指令，从而达到不计算jmp 指令的跳转偏移量来完成Inline Hook的功能。不通过计算jmp指令后的偏移量来完成Inline Hook的功能，需要使用与其等价的指令来完成。在这里修改函数的入口的两条指令来完成Inline Hook,一条是把目标地址存入寄存器eax中，然后用jmp指令直接跳转到寄存器eax中保存的地址处，代码如下：mov eax, 12345678jmp eax用OD随便打开一个程序，然后修改其入口代码为上述代码，再提取其机器码，如图所示。
  
  ![image](https://user-images.githubusercontent.com/96330669/194980175-d72fc21f-eedf-4a27-ac36-a6077ba159a2.png)
从图中可以看出，mov eax,12345678对应的机器码为B878563412,也就是说，B8是mov指令的机器码。再看一下jmpeax,其对应的机器码为FFEO.看过moveax,12345678/peax对应的机器指令以后就会明白，mov指令的机器码是不变的，jmp eax指令的机器码也是不变的，变化的只有地址，而这里的地址可以根据Hook的替换函数直接给出而不需要过行计算。将其定义为一个字节数组：Byte pumpcode [] = {'\xps',,\0', '\0', '\0', '\0', '\xEE', '\xEO' );这样定义以后，只要把目标函数的地址保存在从第一至四字节的位置就可以了（下际是从0开始的）。通过这种方法，就不用再计算jmp要跳转的位置对应的偏移量了。这也是一种进行Inline Hook的方法，不过同样都是修改目标函数的入口，只是替换的字节数量的多少问题。
   7. 2. 5 Inline Hook的注意事项：
在写Hook 函数时一定要注意函数的调用约定，函数的调用约定决定了函数调用传递参数的顺序和函数调用后负责平衡栈的一种约定。如果在调用函数后栈不恢复到调用前的样子的话，那么程序后续的部分一定会报错。程序短可能会不报错，但是千万不要有这样侥幸的心理。
下面用HOOK本进程的例子做一个简单的修改，演示一下调用。HOOK的是MessageBoxA(函数，该函数有4个参数，用户定义的函数也一定要是4个参数。MessageBoxAO函数的调用约定是＿stdcall,那么定义函数时也要使用＿stdcall.定义时使用的是WINAPI,这是一个宏，其定义如下：
＃define WINAPI_stdcall在MSDN中看一下 MessageBox()的函数定义，具体如下：int MessageBox(HWND hWnd,LPCTSTR 1pText,LPCTSTR 1pCaption,UINT uType）；／／ 窗口的句柄／／消息框中的文本／／ 消息框标题／／ 消息框风格

个人微信
目前已经实现了很多有趣的功能，运行稳定，比如：发各种消息，
接收各种消息，群管，下载文件，加好友，检测僵尸粉，朋友圈等等功能，
可提供接口，方便各种语言二次开发，欢迎技术交流，Q：2645542961
，请勿用于商业用途。
![67a7346f82f8ee21970e46f526edfd6](https://user-images.githubusercontent.com/96330669/194980289-d0a8a222-ffe4-4459-ae75-b68fd8827695.png)


企业微信：
目前已经实现了大部分功能，运行稳定，比如：发各种消息，
接收各种消息，外部群内部群管理，下载文件，加好友等等功能，
可提供接口，方便各种语言二次开发，欢迎技术交流。
